---
title: "pydatavolley"
format: gfm
---

A python package for reading volleyball scouting files in DataVolley format (\*.dvw).

<https://pypi.org/project/pydatavolley/>

### Installation[^1]

[^1]: If updating fails, you may need to `pip uninstall pydatavolley` - then reinstall `pip install pydatavolley`

```         
pip install pydatavolley
pip install --upgrade pydatavolley
```

## [Examples]{.underline}

#### Reading one file:

```{python}
# Using read_dv.DataVolley(None) will use example file
import pandas as pd
from datavolley import read_dv
pd.set_option('display.max_rows', 50)
pd.set_option('display.max_columns', 500)
pd.set_option('display.width', 400)
dv_instance = read_dv.DataVolley(None)
df = dv_instance.get_plays()
print(df[588:618])
```

------------------------------------------------------------------------

#### Reading multiple files - grouping for attacks and kills:

```{python}
import pandas as pd
from datavolley import read_dv
import glob
import time
import os

# Assign path
downloads_folder = os.path.expanduser("~\\Downloads")
file_extension = "*.dvw"
pattern = os.path.join(downloads_folder, file_extension)

# Get a list of all files with the specified extension in the directory
file_list = glob.glob(pattern)

# Initialize an empty DataFrame to store combined data
combined_df = pd.DataFrame()

start_time = time.time()  # Record start time
# Loop through each file path
for path in file_list:
    dv_instance = read_dv.DataVolley(path)
    df = dv_instance.get_plays()

    # Concatenate the current DataFrame with the combined DataFrame
    combined_df = pd.concat([combined_df, df], ignore_index=True)

end_time = time.time()  # Record end time
processing_time = end_time - start_time
print(f"{len(file_list)} DVWs processed in {processing_time / 60:.2f} minutes")
# Filter for attacks and print attacks 
print(
    combined_df[combined_df['skill'] == 'Attack']
    .groupby(['player_name', 'team'])
    .agg(Att=('skill', 'count'),
         K=('evaluation_code', lambda x: x.eq('#').sum(skipna=True)),
         K_pct=('evaluation_code', lambda x: round((x.eq('#').sum(skipna=True) / x.count()), 3)))
    .reset_index()
    .sort_values(by='Att', ascending=False)
    .head(20)
    .reset_index(drop=True)
    .to_string()
)
```

------------------------------------------------------------------------

#### Reading multiple files parallel using threads:

```{python}
import pandas as pd
from datavolley import read_dv
import glob
import time
import concurrent.futures
import os

# Assign path
downloads_folder = os.path.expanduser("C:\\Users\\TylerWiddison\\Documents\\Python\\DVWGet2\\dvws\\WCC")
file_extension = "*.dvw"
pattern = os.path.join(downloads_folder, file_extension)

# Get a list of all files with the specified extension in the directory
file_list = glob.glob(pattern)

def read_file(file_path):
    dv_instance = read_dv.DataVolley(file_path)
    return dv_instance.get_plays()

def read_files_parallel(file_paths):
    with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor:
        # Use executor.map to parallelize file reading
        dfs = list(executor.map(read_file, file_paths))
    return pd.concat(dfs, ignore_index=True)

start_time = time.time()  # Record start time
if __name__ == "__main__":
    # Call the function to read files in parallel
    df = read_files_parallel(file_list)
    end_time = time.time()  # Record end time
    processing_time = end_time - start_time
    print(f"{len(file_list)} DVWs processed in {processing_time / 60:.2f} minutes")
    # Now 'df' contains the concatenated DataFrame from all files
    print(df.head())
```

------------------------------------------------------------------------

#### Plotting attacks -

```{python}
# Using read_dv.DataVolley(None) will use example file
import datavolley.pycourt as pycourt
from datavolley import read_dv
import glob
import matplotlib.pyplot as plt
import pandas as pd
dv_instance = read_dv.DataVolley(None)
df = dv_instance.get_plays()
atk_data = df[(df['skill'] == 'Attack') & (df['attack_code'] == 'X5')]
coordainte_df = atk_data[['start_coordinate_x',
                          'start_coordinate_y',
                          'end_coordinate_x',
                          'end_coordinate_y']]

def plot_coordinates(coordinates):
    pycourt.pycourt()

    # Plot the coordinates
    plt.scatter(coordinates['start_coordinate_x'], coordinates['start_coordinate_y'], color='red')
    plt.scatter(coordinates['end_coordinate_x'], coordinates['end_coordinate_y'], color='blue')

    # Connect the coordinates with lines
    for i in range(len(coordinates)):
        start_point = (coordinates['start_coordinate_x'].iloc[i], coordinates['start_coordinate_y'].iloc[i])
        end_point = (coordinates['end_coordinate_x'].iloc[i], coordinates['end_coordinate_y'].iloc[i])
        plt.plot([start_point[0], end_point[0]], [start_point[1], end_point[1]], color='gray', linestyle='--', linewidth=1)

    plt.show(block=True)

plot_coordinates(coordainte_df)

```